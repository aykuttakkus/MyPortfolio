(this.webpackJsonp=this.webpackJsonp||[]).push([["cb024f01"],{NbhA:function(e,t,r){"use strict";var o=r("Bk2k"),i=r.n(o),s=(r("RFHG"),r("z6RN"),r("xuo1"),r("3UXl"),r("iyoE"),r("aFm2"),r("R9qC"),r("CbCZ")),n=r("zIFf"),a=r("Mp8J"),l=r("YH60"),c=r("/lV4"),u=r("tDP3"),d=r("5yoc");var h={components:{GlButton:s.a,EmojiPicker:l.default},directives:{GlTooltip:n.a,SafeHtml:a.a},props:{customEmojiPath:{type:String,required:!1,default:""},awards:{type:Array,required:!0},canAwardEmoji:{type:Boolean,required:!0},currentUserId:{type:[Number,String],required:!1,default:-1},defaultAwards:{type:Array,required:!1,default:function(){return[]}},selectedClass:{type:String,required:!1,default:"selected"}},data:()=>({isMenuOpen:!1}),computed:{groupedDefaultAwards(){return this.defaultAwards.reduce((function(e,t){return Object.assign(e,{[t]:[]})}),{})},groupedAwards(){var e=this;const{thumbsup:t,thumbsdown:r,...o}={...this.groupedDefaultAwards,...i()(this.awards,(function(e){return e.name}))};return[...t?[this.createAwardList(d.i,t)]:[],...r?[this.createAwardList(d.h,r)]:[],...Object.entries(o).map((function([t,r]){return e.createAwardList(t,r)}))]}},mounted(){this.virtualScrollerItem=this.$el.closest(".vue-recycle-scroller__item-view")},methods:{getAwardClassBindings(e){return{[this.selectedClass]:this.hasReactionByCurrentUser(e),disabled:-1===this.currentUserId}},hasReactionByCurrentUser(e){var t=this;return-1!==this.currentUserId&&e.some((function(e){return e.user.id===t.currentUserId}))},createAwardList(e,t){return{name:e,list:t,title:this.getAwardListTitle(t,e),classes:this.getAwardClassBindings(t),html:Object(u.glEmojiTag)(e)}},getAwardListTitle(e,t){var r=this;if(!e.length)return"";const o=e;if(o.length>10&&this.hasReactionByCurrentUser(o)){const e=o.findIndex((function(e){return e.user.id===r.currentUserId}));if(e>9){const t=o[e];o.splice(e,1),o.splice(9,0,t)}}const i=o.map((function({user:e},t){return e.id===r.currentUserId?function(e){return 0===e?Object(c.a)("You"):Object(c.a)("you")}(t):e.name})).slice(0,10),s=o.slice(10,o.length);let n="";return s.length?n=Object(c.j)(Object(c.a)("%{listToShow}, and %{awardsListLength} more"),{listToShow:i.join(", "),awardsListLength:s.length},!1):i.length>1?(n=i.slice(0,i.length-1).join(", "),n+=i.length>2?",":"",n+=Object(c.j)(Object(c.a)(" and %{sliced}"),{sliced:i.slice(-1)},!1)):n=i.join(Object(c.a)(" and ")),n+Object(c.j)(Object(c.a)(" reacted with :%{name}:"),{name:t})},handleAward(e){this.canAwardEmoji&&(this.$emit("award",e),document.activeElement&&document.activeElement.blur())},setIsMenuOpen(e){this.isMenuOpen=e,this.virtualScrollerItem&&(this.virtualScrollerItem.style.zIndex=this.isMenuOpen?1:null)}},safeHtmlConfig:{ADD_TAGS:["gl-emoji"]}},m=r("tBpV"),g=Object(m.a)(h,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"awards js-awards-block"},[e._l(e.groupedAwards,(function(r){return t("gl-button",{directives:[{name:"gl-tooltip",rawName:"v-gl-tooltip"}],key:r.name,staticClass:"gl-my-2 gl-mr-3",class:r.classes,attrs:{title:r.title,"data-emoji-name":r.name,"data-testid":"award-button"},on:{click:function(t){return e.handleAward(r.name)}},scopedSlots:e._u([{key:"emoji",fn:function(){return[t("span",{directives:[{name:"safe-html",rawName:"v-safe-html:[$options.safeHtmlConfig]",value:r.html,expression:"awardList.html",arg:e.$options.safeHtmlConfig}],staticClass:"award-emoji-block",attrs:{"data-testid":"award-html"}})]},proxy:!0}],null,!0)},[e._v(" "),t("span",{staticClass:"js-counter"},[e._v(e._s(r.list.length))])])})),e._v(" "),e.canAwardEmoji?t("div",{staticClass:"award-menu-holder gl-my-2"},[t("emoji-picker",{attrs:{right:!1,"custom-emoji-path":e.customEmojiPath,"data-testid":"emoji-picker"},on:{click:e.handleAward,shown:function(t){return e.setIsMenuOpen(!0)},hidden:function(t){return e.setIsMenuOpen(!1)}}})],1):e._e()],2)}),[],!1,null,null,null);t.a=g.exports},YH60:function(e,t,r){"use strict";r.r(t);var o=r("W7Ty"),i=r.n(o),s=(r("3UXl"),r("iyoE"),r("UezY"),r("z6RN"),r("hG7+"),r("CbCZ")),n=r("2TqH"),a=r("1I5c"),l=r("Lh8o"),c=r("zIFf"),u=r("tDP3"),d=r("/lV4"),h=r("5yoc"),m=r("Am3t"),g=r.n(m),p=r("d+lS"),f=r.n(p),y=r("htNe"),j=r.n(y),b=(r("RFHG"),r("xuo1"),r("NmEs"));const w=function(e){return e*h.g+h.e},v=async function(){let e=localStorage.getItem(h.j);if(!e){const t=Object(b.j)(h.j);if(!t)return null;e=t,function(){const e=Object(b.j)(h.j);localStorage.setItem(h.j,e),Object(b.I)(h.j)}()}const t=[...(await Object(u.getEmojisForCategory)("custom")).map((function(e){return e.name})),...Object(u.getAllEmoji)().map((function(e){return e.n}))],r=g()(f()(e.split(",")).filter((function(e){return t.includes(e)})),9);return{frequently_used:{emojis:r,top:0,height:w(r.length)}}},C=j()((async function(){await Object(u.initEmojiMap)();const e=await Object(u.getEmojiCategoryMap)(),t=await v();let r=t?t.frequently_used.top+t.frequently_used.height:0;return Object.freeze(Object.keys(e).filter((function(t){return t!==h.k&&e[t].length})).reduce((function(t,o){const i=g()(e[o],h.f),s=w(i.length),n={...t,[o]:{emojis:i,height:s,top:r}};return r+=s,n}),t||{}))}));var k={props:{searchValue:{type:String,required:!0}},data:()=>({categories:{},showEmojiList:!1}),computed:{filteredCategories(){if(""!==this.searchValue){const e=g()(Object(u.searchEmoji)(this.searchValue).map((function({emoji:e}){return e.name})),h.f);return{search:{emojis:e,height:w(e.length)}}}return this.categories}},async mounted(){try{this.categories=await C(),this.showEmojiList=!0}catch(e){this.categories={}}}},_=r("tBpV"),O=Object(_.a)(k,(function(){var e=this._self._c;return this.showEmojiList?e("div",[this._t("default",null,{filteredCategories:this.filteredCategories})],2):this._e()}),[],!1,null,null,null).exports,E=(r("aFm2"),r("R9qC"),r("gFTu")),S=r("0AwG"),A={components:{GlButton:s.a},props:{emojis:{type:Array,required:!0},renderGroup:{type:Boolean,required:!0}},methods:{clickEmoji(e){this.$emit("emoji-click",e)}}},x=Object(_.a)(A,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"gl-mb-2 gl-flex gl-flex-wrap"},[e.renderGroup?e._l(e.emojis,(function(r){return t("gl-button",{key:r,staticClass:"emoji-picker-emoji",attrs:{type:"button",category:"tertiary","aria-label":r,"data-testid":"emoji-button","button-text-classes":"!gl-hidden"},on:{click:function(t){return e.clickEmoji(r)},keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.clickEmoji(r)}},scopedSlots:e._u([{key:"emoji",fn:function(){return[t("gl-emoji",{staticClass:"!gl-mr-0",attrs:{"data-name":r}})]},proxy:!0}],null,!0)})})):e._e()],2)}),[],!1,null,null,null).exports,T={components:{GlIntersectionObserver:E.a,EmojiGroup:x},props:{category:{type:String,required:!0},emojis:{type:Array,required:!0}},data:()=>({renderGroup:!1}),computed:{categoryTitle(){return Object(S.r)(this.category)}},methods:{categoryAppeared(){this.renderGroup=!0,this.$emit("appear",this.category)},onClick(e){this.$emit("click",{category:this.category,emoji:e})}}},I={name:"VirtualList",components:{Category:Object(_.a)(T,(function(){var e=this,t=e._self._c;return t("gl-intersection-observer",{staticClass:"gl-h-full gl-px-4",on:{appear:e.categoryAppeared}},[t("div",{staticClass:"emoji-picker-category-header gl-top-0 gl-z-3 gl-w-full gl-py-3 gl-text-sm"},[t("b",[e._v(e._s(e.categoryTitle))])]),e._v(" "),e.emojis.length?e._l(e.emojis,(function(r,o){return t("emoji-group",{key:o,attrs:{emojis:r,"render-group":e.renderGroup},on:{"emoji-click":e.onClick}})})):t("p",[e._v("\n    "+e._s(e.s__("AwardEmoji|No emoji found."))+"\n  ")])],2)}),[],!1,null,null,null).exports},props:{searchTerm:{type:String,required:!1,default:""},categories:{type:Object,required:!0},scrollTop:{type:Number,required:!1,default:0}},emits:["select-emoji","scroll"],computed:{categoryList(){return Object.entries(this.categories).map((function([e,t]){return{key:e,...t}}))},buffer(){return 2*this.$options.areaHeight},isSearching(){return this.searchTerm&&"string"==typeof this.searchTerm},visibleItems(){var e=this;return this.isSearching?this.categoryList:this.categoryList.filter((function(t){const r=t.top,o=r+t.height,i=e.scrollTop-e.buffer,s=e.scrollTop+e.$options.areaHeight+e.buffer;return o>i&&r<s}))}},watch:{scrollTop(e){this.$refs.container&&"number"==typeof e&&(this.$refs.container.scrollTop=e)}},methods:{handleScroll(e){this.$emit("scroll",{offset:e.target.scrollTop})}},areaHeight:253},L=Object(_.a)(I,(function(){var e=this,t=e._self._c;return t("div",{ref:"container",staticClass:"gl-overflow-y-auto",style:{height:e.$options.areaHeight+"px"},attrs:{"data-testid":"virtual-list-container"},on:{scroll:e.handleScroll}},e._l(e.categoryList,(function(r){return t("div",{key:r.key,style:{height:r.height+"px"},attrs:{"data-testid":"category-wrapper"}},[t("category",{directives:[{name:"show",rawName:"v-show",value:e.visibleItems.some((function(e){return e.key===r.key})),expression:"visibleItems.some((v) => v.key === item.key)"}],attrs:{category:r.key,emojis:r.emojis},on:{click:function(t){return e.$emit("select-emoji",t)}}})],1)})),0)}),[],!1,null,null,null).exports,V={components:{GlButton:s.a,GlDisclosureDropdown:n.a,GlSearchBoxByType:a.a,GlAnimatedSmileIcon:l.a,VirtualList:L,EmojiList:O},directives:{GlTooltip:c.a},inject:{newCustomEmojiPath:{default:""}},props:{toggleClass:{type:[Array,String,Object],required:!1,default:function(){return[]}},toggleCategory:{type:String,required:!1,default:null},dropdownClass:{type:[Array,String,Object],required:!1,default:function(){return[]}},right:{type:Boolean,required:!1,default:!0},customEmojiPath:{type:String,required:!1,default:""},buttonTitle:{type:String,required:!1,default:null}},data:()=>({isVisible:!1,isHovered:!1,isFocused:!1,currentCategory:0,searchValue:"",scrollTop:0}),computed:{newEmojiPath(){return this.newCustomEmojiPath||this.customEmojiPath},categoryNames:()=>h.d.filter((function(e){return e===h.k?async function(){return null!==await v()}():"custom"!==e||!u.state.loading&&Object(u.getEmojiCategoryMap)().custom.length>0})).map((function(e){return{name:e,icon:h.c[e]}})),placement(){return this.right?"bottom-end":"bottom-start"},smileIcon(){return this.isHovered||this.isFocused||this.isVisible}},methods:{async scrollToCategory(e){const t=await C(),{top:r}=t[e];this.scrollTop=r},selectEmoji({category:e,emoji:t}){this.$emit("click",t),this.$refs.dropdown.close(),"custom"!==e&&function(e){const t=f()((localStorage.getItem(h.j)||Object(b.j)(h.j)||"").split(",").filter((function(e){return e})).concat(e));localStorage.setItem(h.j,t.join(","))}(t)},onSearchInput(){this.$refs.virtualList&&(this.scrollTop=0)},async onScroll({offset:e}){this.scrollTop=e;const t=await C();this.currentCategory=i()(Object.values(t),(function({top:t}){return e>=t}))},onShow(){this.isVisible=!0,this.$emit("shown")},onHide(){this.isVisible=!1,this.currentCategory=0,this.searchValue="",this.$emit("hidden")},onButtonHovered(){this.isHovered=!0},onButtonHoverLeave(){this.isHovered=!1},onButtonFocused(){this.isFocused=!0},onButtonFocusLeave(){this.isFocused=!1}},i18n:{addReaction:Object(d.a)("Add reaction"),createEmoji:Object(d.a)("Create new emoji")}},q=Object(_.a)(V,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"emoji-picker"},[t("gl-disclosure-dropdown",{ref:"dropdown",class:e.dropdownClass,attrs:{placement:e.placement},on:{shown:e.onShow,hidden:e.onHide},scopedSlots:e._u([{key:"toggle",fn:function({accessibilityAttributes:r}){return[t("gl-button",e._b({directives:[{name:"gl-tooltip",rawName:"v-gl-tooltip"}],staticClass:"add-reaction-button btn-icon gl-relative gl-h-full",class:[e.toggleClass,{"is-active":e.isVisible}],attrs:{title:e.buttonTitle||e.$options.i18n.addReaction,category:e.toggleCategory,"data-testid":"add-reaction-button"},on:{mouseover:e.onButtonHovered,mouseleave:e.onButtonHoverLeave,focusin:e.onButtonFocused,focusout:e.onButtonFocusLeave}},"gl-button",r,!1),[e._t("button-content",(function(){return[t("gl-animated-smile-icon",{staticClass:"gl-button-icon",attrs:{"is-on":e.smileIcon}})]}))],2)]}},e.isVisible?{key:"header",fn:function(){return[t("gl-search-box-by-type",{ref:"searchValue",staticClass:"add-reaction-search gl-border-b-1 gl-border-b-dropdown gl-border-b-solid",attrs:{borderless:"",autofocus:"",debounce:"500","aria-label":e.__("Search for an emoji")},on:{input:e.onSearchInput},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}})]},proxy:!0}:null,e.newEmojiPath?{key:"footer",fn:function(){return[t("div",{staticClass:"gl-flex gl-flex-col gl-border-t-1 gl-border-t-dropdown !gl-p-2 !gl-pt-0 gl-border-t-solid"},[t("gl-button",{staticClass:"!gl-mt-2 !gl-justify-start",attrs:{href:e.newEmojiPath,category:"tertiary",block:"","data-testid":"create-new-emoji"}},[e._v("\n          "+e._s(e.$options.i18n.createEmoji)+"\n        ")])],1)]},proxy:!0}:null],null,!0)},[e._v(" "),e._v(" "),e.isVisible?t("div",{directives:[{name:"show",rawName:"v-show",value:!e.searchValue,expression:"!searchValue"}],staticClass:"gl-flex gl-border-b-1 gl-border-default gl-border-b-solid",attrs:{"data-testid":"category-buttons"}},e._l(e.categoryNames,(function(r,o){return t("gl-button",{key:r.name,staticClass:"emoji-picker-category-tab gl-grow !gl-rounded-none !gl-border-b-2 !gl-px-3 !gl-border-b-solid focus:!gl-shadow-none focus:!gl-outline focus:!gl-outline-2 focus:-gl-outline-offset-2 focus:!gl-outline-focus",class:{"emoji-picker-category-active":o===e.currentCategory},attrs:{category:"tertiary",icon:r.icon,"aria-label":r.name},on:{click:function(t){return e.scrollToCategory(r.name)},keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.scrollToCategory(r.name)}}})})),1):e._e(),e._v(" "),e.isVisible?t("emoji-list",{attrs:{"search-value":e.searchValue},scopedSlots:e._u([{key:"default",fn:function({filteredCategories:r}){return[t("virtual-list",{ref:"virtualList",attrs:{categories:r,"search-term":e.searchValue,"scroll-top":e.scrollTop},on:{"select-emoji":e.selectEmoji,scroll:e.onScroll}})]}}],null,!1,4253650989)}):e._e()],1)],1)}),[],!1,null,null,null);t.default=q.exports}}]);
//# sourceMappingURL=cb024f01.6df5209b.chunk.js.map