(this.webpackJsonp=this.webpackJsonp||[]).push([["commons-pages.admin.topics.edit-pages.admin.topics.new-pages.groups.comment_templates-pages.groups.e-27598f61"],{FVJN:function(t,e,n){"use strict";n.d(e,"a",(function(){return z}));n("B++/"),n("z6RN"),n("47t/");var i=n("oCX2"),s=n("unPA"),a=n("NmEs"),o=n("G3fq"),r=n.n(o),l=(n("3UXl"),n("iyoE"),n("ZzK0"),n("BzOf"),n("aFm2"),n("R9qC"),n("UezY"),n("hG7+"),n("ClPU")),u=n.n(l),c=n("EmJ/"),h=n.n(c),d=(n("d8P8"),n("O4Ih")),f=n("0AwG"),m=n("/lV4"),p=n("vR0m");n("v2fZ");class g{constructor(t){this.data=t,this.columnWidths=[],this.rows=[],this.tableFound=this.parseTable()}isTable(){return this.tableFound}convertToTableMarkdown(){var t=this;this.calculateColumnWidths();const e=this.rows.map((function(e){return`| ${e.map((function(e,n){return t.formatColumn(e,n)})).join(" | ")} |`}));return e.splice(1,0,this.generateHeaderBreak()),e.join("\n")}parseTable(){if(!this.data.types.includes("text/html")||!this.data.types.includes("text/plain"))return!1;const t=this.data.getData("text/html");this.doc=(new DOMParser).parseFromString(t,"text/html");if(1!==this.doc.querySelectorAll("table:not(.diff-wrap-lines)").length)return!1;const e=this.data.getData("text/plain").trim().split(/[\n\u0085\u2028\u2029]|\r\n?/g);return this.doc.querySelectorAll("tr").length===e.length&&(this.rows=e.map((function(t){return t.split("\t")})),this.normalizeRows(),!!this.columnCountsMatch())}normalizeRows(){const t=this.rows.map((function(t){return t.length})),e=Math.max(...t);this.rows.forEach((function(t){for(;t.length<e;)t.push("")}))}calculateColumnWidths(){var t=this;this.columnWidths=this.rows[0].map((function(e,n){return function(t,e){return Math.max(...t.map((function(t){return t[e].length})))}(t.rows,n)}))}columnCountsMatch(){const t=this.rows[0].length;let e=0;return this.doc.querySelectorAll("table tr").forEach((function(t){e=Math.max(t.cells.length,e)})),t===e}formatColumn(t,e){return t+Array(this.columnWidths[e]-t.length+1).join(" ")}generateHeaderBreak(){var t=this;return`|${this.columnWidths.map((function(e,n){return Array(t.columnWidths[n]+3).join("-")})).join("|")}|`}}var v=n("2ibD"),w=n("Qhxq");async function x(t,e){const n=await Object(p.a)(e);return n?`${t}{width=${n.width} height=${n.height}}`:t}function b(t,e={parallelUploads:2}){var n;const i=Object(a.Q)("paperclip","div-dropzone-icon s24"),s=t.find(".attaching-file-message"),o=t.find(".button-cancel-uploading-files"),l=t.find(".retry-uploading-link"),c=t.find(".uploading-progress"),p=t.find(".uploading-error-container"),b=t.find(".uploading-error-message"),y=t.find(".uploading-progress-container"),z=t.data("uploads-path")||window.uploads_path||null,C=gon.max_file_size||10,M=t.find(".js-gfm-input");let j,E,O,F,R,k;M.wrap('<div class="div-dropzone"></div>');const D=M.closest(".md-area"),L=t.find(".div-dropzone");if(L.parent().addClass("div-dropzone-wrapper"),L.append('<div class="div-dropzone-hover"></div>'),L.find(".div-dropzone-hover").append(i),!z)return L.addClass("js-invalid-dropzone"),null;M.on("paste",(function(t){return j(t)}));const A=L.dropzone({url:z,dictDefaultMessage:"",clickable:null===(n=t.get(0).querySelector('[data-button-type="attach-file"]'))||void 0===n||n,paramName:"file",maxFilesize:C,uploadMultiple:!1,headers:w.a.headers,previewContainer:!1,...e,dragover:function(){D.addClass("is-dropzone-hover"),t.find(".div-dropzone-hover").css("opacity",.7)},dragleave:function(){D.removeClass("is-dropzone-hover"),t.find(".div-dropzone-hover").css("opacity",0)},drop:function(){D.removeClass("is-dropzone-hover"),t.find(".div-dropzone-hover").css("opacity",0),M.focus()},async success(t,e){const n=this.getQueuedFiles().length+this.getUploadingFiles().length>=1;O(e.link.url,t.size);const i=await x(e.link.markdown,t);E(i,n)},error:function(t,e=Object(m.a)("Attaching the file failed."),n){const i=(s=e||n.responseText)&&"string"!=typeof s?s.message:s;var s;p.removeClass("hide"),b.html(i),o.addClass("hide")},totaluploadprogress(t){F(this.files,s),c.text(Math.round(t)+"%")},sending:function(){p.addClass("hide"),y.removeClass("hide"),o.removeClass("hide")},removedfile:function(){o.addClass("hide"),y.addClass("hide"),p.addClass("hide")},queuecomplete:function(){h()(".dz-preview").remove(),h()(".markdown-area").trigger("input"),y.addClass("hide"),o.addClass("hide")}}),U=h()(A[0]).children("textarea");o.on("click",(function(t){t.preventDefault(),t.stopPropagation(),u.a.forElement(L.get(0)).removeAllFiles(!0)})),l.on("click",(function(t){const e=u.a.forElement(t.target.closest(".js-main-target-form").querySelector(".div-dropzone")),n=e.files;t.preventDefault(),e.removeAllFiles(!0),n.map((function(t){const n=t;return n.status===u.a.ERROR&&(n.status=void 0,n.accepted=void 0),e.addFile(n)}))})),j=function(t){const e=t.originalEvent,{clipboardData:n}=e;if(n&&n.items){const i=new g(n);if(i.isTable()){t.preventDefault();const e=i.convertToTableMarkdown();E(e)}else if(!k(e)){[...n.files].forEach((function(e){if(-1!==e.type.indexOf("image")){t.preventDefault();const n=246,i=Object(d.b)(e)||"image.png",s=Object(f.E)(i,n);E(`{{${s}}}`),R(e,s)}}))}}},k=function(t){return[...t.clipboardData.items].some((function(t){return"text/plain"===t.type}))},E=function(t,e){let n=t;e&&(n+="\n\n");const i=U.get(0);Object(a.q)(i,n),M.get(0).dispatchEvent(new Event("input")),M.trigger("input")},O=function(e){h()(t).append(`<input type="hidden" name="files[]" value="${r()(e)}">`)};const q=function(){return y.addClass("hide")};function S(t){t.preventDefault(),h()(this).closest(".gfm-form").find(".div-dropzone").click(),M.focus()}R=function(t,e){const n=new FormData;n.append("file",t,e),y.removeClass("hide"),v.a.post(z,n).then((async function({data:n}){const i=await x(n.link.markdown,t);!function(t,e){const n=h()(U),i=n.get(0),s=`{{${t}}}`,o=i.value.indexOf(s);if(-1!==o){const t=o+s.length;i.setSelectionRange(o,t)}Object(a.q)(i,e),n.trigger("change")}(e,i),q()})).catch((function(t){var e;e=t.response.data.message,p.removeClass("hide"),b.html(e),q()}))},F=function(t,e){const n=t.filter((function(t){return"uploading"===t.status||"queued"===t.status})).length,i=Object(m.h)("Attaching a file","Attaching %d files",n);e.text(i+" -")},t.find(".markdown-selector").click(S);const H=t.find(".js-attach-file-button");return H.length&&H.get(0).addEventListener("click",S),L.get(0)?u.a.forElement(L.get(0)):null}u.a.autoDiscover=!1;var y=n("tXF7");class z{constructor(t,e={},n=!1,i={}){var a;this.form=t,this.textarea=this.form.find("textarea.js-gfm-input"),this.enableGFM={...s.b,...e},this.isManuallyResizing=!1,[this.textareaElement]=this.textarea,this.handleFocus=this.handleFocus.bind(this),this.handleBlur=this.handleBlur.bind(this),this.handleManualResize=this.handleManualResize.bind(this),this.handleManualResizeUp=this.handleManualResizeUp.bind(this);const o=z.getDataSources(i);this.filterEnabledGFM(o),this.destroy(),this.setupForm(o,n),this.form.data("glForm",this),null!==(a=this.textarea[0])&&void 0!==a&&null!==(a=a.closest(".js-editor"))&&void 0!==a&&null!==(a=a.dataset)&&void 0!==a&&a.gfmEditorMinHeight&&(this.textarea[0].style.minHeight=this.textarea[0].closest(".js-editor").dataset.gfmEditorMinHeight)}static getDataSources(t){return Object.keys(t).length>0?t:gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources||{}}filterEnabledGFM(t){for(const[e,n]of Object.entries(this.enableGFM))n&&"emojis"!==e&&!t[Object(s.c)(e)]&&(this.enableGFM[e]=!1)}destroy(){var t,e;this.clearEventListeners(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),null===(t=this.autoComplete)||void 0===t||t.destroy(),null===(e=this.formDropzone)||void 0===e||e.destroy(),this.form.data("glForm",null)}setupForm(t,e=!1){const n=this.form.is(":not(.gfm-form)")||e;this.form.removeClass("js-new-note-form"),n&&this.initializeNewForm(t),this.addEventListeners(),Object(y.b)(this.form),this.form.show(),!0===this.textarea.data("autofocus")&&this.textarea.focus()}initializeNewForm(t){this.form.find(".div-dropzone").remove(),this.form.addClass("gfm-form"),Object(a.i)(this.form.find(".js-note-text"),this.form.find(".js-comment-button, .js-note-new-discussion")),this.autoComplete=new s.a(t),this.autoComplete.setup(this.form.find(".js-gfm-input"),this.enableGFM),this.formDropzone=b(this.form,{parallelUploads:1}),this.form.is(":not(.js-no-autosize)")&&Object(i.a)(this.textarea)}updateAutocompleteDataSources(t){this.autoComplete&&this.autoComplete.updateDataSources(t)}clearEventListeners(){this.textarea.off("focus"),this.textarea.off("blur"),this.textarea.off("mousedown"),Object(y.d)(this.form)}addEventListeners(){this.textarea.on("focus",this.handleFocus),this.textarea.on("blur",this.handleBlur),this.textarea.on("mousedown",this.handleManualResize)}handleFocus(){this.textarea.closest(".md-area").addClass("is-focused")}handleBlur(){this.textarea.closest(".md-area").removeClass("is-focused")}handleManualResize(t){const e=this.textarea.closest(".md-area textarea")[0].getBoundingClientRect(),n=t.clientX,i=t.clientY;n>=e.right-16&&n<=e.right&&i>=e.bottom-16&&i<=e.bottom&&(this.isManuallyResizing=!0,this.textarea[0].style.minHeight=null,this.textarea[0].closest(".js-editor").dataset.gfmEditorMinHeight=null,this.textarea.on("mouseup",this.handleManualResizeUp))}handleManualResizeUp(){if(this.textarea[0]){const t=this.textarea[0].offsetHeight+"px";this.textarea[0].style.minHeight=t,this.textarea[0].closest(".js-editor").dataset.gfmEditorMinHeight=t}this.textarea.off("mouseup")}get supportsQuickActions(){return Boolean(this.textarea.data("supports-quick-actions"))}}},O4Ih:function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"d",(function(){return a})),n.d(e,"c",(function(){return o}));n("3UXl"),n("iyoE");var i=n("GuZl");e.a=function(t,e){const n=document.querySelector(t),i=document.querySelector(e);if(!n||!i)return;const s=n.closest("form");n.addEventListener("click",(function(){i.click()})),i.addEventListener("change",(function(){s.querySelector(".js-filename").textContent=i.value.replace(/^.*[\\\/]/,"")}))};const s=function(t){let e;return t&&(e=t.name),e},a=function(t){const e=t.name?t.name:"image.png";return i.j.test(e)?e:"image.png"},o=function(t,e){const n=t.split("."),i=("."+n[n.length-1]).toLowerCase();return e.map((function(t){return t.toLowerCase()})).includes(i)}},vR0m:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));n("3UXl"),n("iyoE"),n("E7T3"),n("lFMf"),n("gOHk"),n("c9hT");class i{constructor(t,e){this.x=t,this.y=e}eq(t,e){return this.x===t&&this.y===e}neq(t,e){return this.x!==t||this.y!==e}gte(t,e){return this.x>=t&&this.y>=e}gt(t,e){return this.x>t&&this.y>e}lte(t,e){return this.x<=t&&this.y<=e}lt(t,e){return this.x<t&&this.y<e}map(t){return new i(t(this.x),t(this.y))}mul(t){return new i(this.x*t,this.y*t)}div(t){return new i(this.x/t,this.y/t)}add(t,e){return new i(this.x+t,this.y+e)}sub(t,e){return new i(this.x-t,this.y-e)}round(){return new i(Math.round(this.x),Math.round(this.y))}floor(){return new i(Math.floor(this.x),Math.floor(this.y))}ceil(){return new i(Math.ceil(this.x),Math.ceil(this.y))}toSize(){return{width:this.x,height:this.y}}}var s=function(t,e){return new i(t,e)};const a={width:900,height:600},o=function(t){const e=t.split("").map((function(t){return t.charCodeAt(0)}));return(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3]},r=function(t){const e=atob(t.split(",")[1]).split("IDAT")[0],n=function(t){const e=t.indexOf("pHYs");if(-1===e)return null;const n=t.substring(e+4,e+4+9);return 1!==n.charCodeAt(8)?null:s(n.substring(0,4),n.substring(4,8)).map(o).div(39.3701).round()}(e);if(n.lte(72,72))return null;const i=e.substring(0,30).indexOf("IHDR");if(-1===i)return null;const a=e.substring(i+4,i+4+8);return s(a.substring(0,4),a.substring(4,8)).map(o).mul(72).div(Math.max(n.x,n.y)).ceil().toSize()},l=async function(t){let e=null;if(t.type.startsWith("video/")&&(e=await async function(t){return new Promise((function(e){const n=document.createElement("video");let i;n.preload="metadata";const s=setTimeout((function(){n.removeEventListener("loadedmetadata",i),URL.revokeObjectURL(n.src),e(null)}),50);i=function(){clearTimeout(s),URL.revokeObjectURL(n.src),e({width:n.videoWidth,height:n.videoHeight})},n.addEventListener("loadedmetadata",i,{once:!0}),n.src=URL.createObjectURL(t)}))}(t)),t.type.startsWith("image/")){const n=await function(t){return new Promise((function(e){const n=new FileReader;n.addEventListener("load",(function(t){return e(t.target.result)}),{once:!0}),n.readAsDataURL(t)}))}(t);if("image/png"===t.type)try{const t=r(n);if(t)return t}catch(t){}try{const t=await function(t){return new Promise((function(e,n){const i=new Image;i.addEventListener("load",(function(){e(i)})),i.addEventListener("error",(function(t){n(t)})),i.src=t}))}(n);e={width:t.width,height:t.height}}catch(t){}}return e&&(n=t.name).substring(0,n.lastIndexOf(".")).endsWith("@2x")?{width:Math.ceil(e.width/2),height:Math.ceil(e.height/2)}:e;var n},u=async function(t,e=a){const n=await l(t);return n?function(t,e){const{width:n,height:i}=e;let{width:s,height:a}=t;return s<=0||a<=0?null:(s>n&&(a*=n/s,s=n),a>i&&(s*=i/a,a=i),{width:Math.ceil(s),height:Math.ceil(a)})}(n,e):null}}}]);
//# sourceMappingURL=commons-pages.admin.topics.edit-pages.admin.topics.new-pages.groups.comment_templates-pages.groups.e-27598f61.6f8b3910.chunk.js.map