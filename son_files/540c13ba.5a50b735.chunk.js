(this.webpackJsonp=this.webpackJsonp||[]).push([["540c13ba","shortcutsBundle"],{tXF7:function(t,e,n){"use strict";n.d(e,"c",(function(){return w})),n.d(e,"g",(function(){return O})),n.d(e,"b",(function(){return _})),n.d(e,"a",(function(){return R})),n.d(e,"d",(function(){return C})),n.d(e,"f",(function(){return $})),n.d(e,"e",(function(){return I}));n("v2fZ"),n("LdIe"),n("z6RN"),n("PTOk"),n("3UXl"),n("iyoE"),n("ZzK0"),n("BzOf"),n("B++/"),n("47t/");var o=n("EmJ/"),r=n.n(o),s=n("v+Mp"),c=n("NmEs"),i=n("2ibD"),a=n("3twG");const l=["**","`","_","~~"],u=/^((\s{0,3}-+\s*-+\s*-+\s*[\s-]*)|(\s{0,3}\*+\s*\*+\s*\*+\s*[\s*]*))$/,d=/^(?<indent>\s+)(?<content>.)?/,f=/^(?<indent>\s*)(?<leader>((?<isUl>[*+-])|(?<isOl>\d+\.))( \[([xX~\s])\])?\s)(?<content>.)?/,h=/^\s{0,3}>\s?/;let g=!1;function p(t,e){return t.substring(e.selectionStart,e.selectionEnd)}function m(t,e){return`${t}\n${e}\n${t}`}function b(t,e){const n=function(t,e){return t.substring(Math.max(0,e.selectionStart-1),e.selectionStart)}(t,e),o=function(t,e){return t.substring(e.selectionEnd,Math.min(e.selectionEnd+1,t.length))}(t,e);return{"[":"]","(":")"}[n]===o}function v(t){const e=t.value,{selectionStart:n,selectionEnd:o}=t;let r="\n"===e[n]?n-1:n;r=e.lastIndexOf("\n",r)+1;let s=o===n?o:o-1;s=e.indexOf("\n",s),s<0&&(s=e.length);return{lines:e.substring(r,s).split("\n"),selectionStart:n,selectionEnd:o,startPos:r,endPos:s}}function S(t,e,n,o,r,s){let c=Math.max(o,e+r),i=Math.max(o,n+s);e===n?i=c:e===o&&(c=o),t.setSelectionRange(c,i)}function x(t){return{start:{row:(e=t.getSelection()).startLineNumber,column:e.startColumn},end:{row:e.endLineNumber,column:e.endColumn}};var e}function w({textArea:t,text:e,tag:n,cursorOffset:o,blockTag:r,selected:s="",wrap:i,select:u,editor:d}){var f;if(!n&&!r&&!s)return;let g=!1,p=!1,b=!1;const v=(s=null!==(f=function(t,e){if(!t||!e||!l.includes(e))return;const n=t.value.substring(t.selectionStart,t.selectionEnd);if(n.startsWith(e)&&n.endsWith(e))return;const o=Math.max(t.selectionStart-e.length,0),r=Math.min(t.selectionEnd+e.length,t.value.length),s=t.value.substring(o,r);return s.startsWith(e)&&s.endsWith(e)&&(t.selectionStart=o,t.selectionEnd=r),t.value.substring(t.selectionStart,t.selectionEnd)}(t,n))&&void 0!==f?f:s).length,{selectionStart:S,selectionEnd:w}=t||{};let O,E,j,k;if(s=s.toString(),d){const t=x(d);O=t.start,E=t.end}"[{text}](url)"===n&&Object(a.x)(s)&&(n="[text]({text})",u="text"),0===s.indexOf("\n")&&(p=!0,s=s.replace(/\n+/,"")),t?t.selectionEnd-t.selectionStart>s.replace(/\n$/,"").length&&(g=!0,s=s.replace(/\n$/,"")):d&&O.row!==E.row&&(g=!0,s=s.replace(/\n$/,""));const T=s.split("\n");d&&!i?(j=d.getValue().split("\n")[O.row],/^\s*$/.test(j)&&(b=!0)):t&&!i&&(j=t.value.substr(0,t.selectionStart).lastIndexOf("\n"),/^\s*$/.test(t.value.substring(j,t.selectionStart))&&(b=!0));const y=t&&0===t.selectionStart||d&&0===O.column&&0===O.row,P=i||b||y?"":"\n",{shouldUseSelectedWithoutTags:A,removeTagFromLine:M,shouldRemoveTagFromLine:D,getSelectedWithoutTags:_,shouldPreserveTextAreaSelection:R}=function({selected:t,tag:e,selectedSplit:n}){if("> "===e){const o=n.every((function(t){return h.test(t)}));return{getSelectedWithoutTags:function(){return t.slice(t.match(h)[0].length,t.length)},shouldUseSelectedWithoutTags:h.test(t),removeTagFromLine:function(t){return t.replace(h,"")},shouldRemoveTagFromLine:function(){return o},shouldPreserveTextAreaSelection:l.includes(e)&&t.length>0}}return{getSelectedWithoutTags:function(){return t.slice(e.length,t.length-e.length)},shouldUseSelectedWithoutTags:t.length>=2*e.length&&t.startsWith(e)&&t.endsWith(e)&&l.includes(e),removeTagFromLine:function(t){return t.replace(e,"")},shouldRemoveTagFromLine:function(t){return 0===t.indexOf(e)},shouldPreserveTextAreaSelection:l.includes(e)&&t.length>0}}({selected:s,tag:n,selectedSplit:T});if(k=T.length>1&&(!i||null!=r&&""!==r)?null!=r&&""!==r?d?function(t,e,n,o){const r=t.split("\n"),s=x(o);if(r[s.start.row-1]===e&&r[s.end.row+1]===e){if(null!==e){const t=r[s.end.row+1],e=new Range(r[s.start.row-1],0,s.end.row+1,t.length);o.getSelection().setSelectionRange(e)}return n}return m(e,n)}(e,r,s,d):function(t,e,n,o){return function(t,e){let n=t.substring(0,e.selectionStart);n=n.split("\n");const o=n[n.length-2];return void 0===o?"":o}(t,e)===n&&function(t,e){let n=t.substring(e.selectionEnd);return n=n.replace(/^\n/,""),n=n.split("\n"),n[0]}(t,e)===n?(null!=n&&(e.selectionStart=e.selectionStart-(n.length+1),e.selectionEnd=e.selectionEnd+(n.length+1)),o):m(n,o)}(e,t,r,s):T.map((function(t){return n.indexOf("{text}")>-1?n.replace("{text}",t):D(t)?M(t):String(n)+t})).join("\n"):n.indexOf("{text}")>-1?n.replace("{text}",(function(){return s.replace(/\\n/g,"\n").replace(/%br/g,"\\n")})):A?_():`${P}${n}${s}${i?n:""}`,p&&(k="\n"+k),g&&(k+="\n"),d?d.replaceSelectedText(k,u):Object(c.q)(t,k),R){const e=k.length-v;t.setSelectionRange(S,w+e)}else!function({textArea:t,tag:e,cursorOffset:n,positionBetweenTags:o,removedLastNewLine:r,select:s,editor:c,editorSelectionStart:i,editorSelectionEnd:a}){let l;if(!t||t.setSelectionRange){if(s&&s.length>0){if(t){const n=t.selectionStart-(e.length-e.indexOf(s)),o=n+s.length;return t.setSelectionRange(n,o)}if(c)return void c.selectWithinSelection(s,e)}if(t){if(t.selectionStart===t.selectionEnd)l=o?t.selectionStart-e.length:t.selectionStart,r&&(l-=1),n&&(l-=n),t.setSelectionRange(l,l)}else c&&i.row===a.row&&o&&c.moveCursor(-1*e.length)}}({textArea:t,tag:n.replace("{text}",s),cursorOffset:o,positionBetweenTags:i&&0===s.length,removedLastNewLine:g,select:u,editor:d,editorSelectionStart:O,editorSelectionEnd:E})}function O({textArea:t,tag:e,cursorOffset:n,blockTag:o,wrap:s,select:c,tagContent:i,replaceText:a=!1}){const l=r()(t);t=l.get(0);const u=l.val(),d=a?"":p(u,t)||i;t.focus(),w({textArea:t,text:u,tag:e,cursorOffset:n,blockTag:o,selected:d,wrap:s,select:c}),t.click()}function E(t,e){return function(t){return!("Enter"!==t.key||t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)}(t)&&e.selectionStart===e.selectionEnd&&!g}function j(t,e){const{indent:n,leader:o}=t.groups,[,r=""]=o.split(".");return`${n}${e}.${r}`}function k(t,e,n){const{indent:o}=e.groups,{lines:r,startPos:s,endPos:i}=function(t,e){const{selectionEnd:n,value:o}=t,r=o.indexOf("\n",n);if(-1===r)return{lines:[],startPos:-1,endPos:-1};const s=o.substring(r),c=[],i=r+1;let a=i;for(const t of s.replace(/^\n/,"").split("\n")){if(!e(t))break;c.push(t),a+=t.length+1}return{lines:c,startPos:i,endPos:a-1}}(t,(function(t){var e;const n=t.match(f),{indent:r,isOl:s}=null!==(e=null==n?void 0:n.groups)&&void 0!==e?e:{};return s&&r===o}));!function({textArea:t,lines:e,startPos:n,endPos:o,from:r}){if(0===e.length)return;const s=[],{selectionStart:i,selectionEnd:a}=t;let l=r;e.forEach((function(t){const e=t.match(f),n=t.slice(e.groups.leader.length+e.groups.indent.length),o=j(e,l)+n;s.push(o),l+=1})),t.focus(),t.setSelectionRange(n,o);const u=s.join("\n");Object(c.q)(t,u),t.setSelectionRange(i,a)}({textArea:t,lines:r,startPos:s,endPos:i,from:n})}function T(t,e){if(!gon.markdown_automatic_lists)return;if(!E(t,e))return;const n=v(e),o=n.lines[0],r=o.match(f);if(r){const{leader:s,indent:c,content:i,isOl:a}=r.groups,l=!i,d=s.length+c.length;if(n.selectionStart-n.startPos<d)return;if(l)return e.selectionStart=e.selectionStart-r[0].length,void k(e,r,1);let f;if(a){const t=function({groups:{leader:t}}){return parseInt(t,10)}(r)+1;f=j(r,t),k(e,r,t+1)}else{if(o.match(u))return;f=`${c}${s}`}f=f.replace(/\[[x~]\]/i,"[ ]"),t.preventDefault(),O({tag:f,textArea:e,blockTag:"",wrap:!1,select:"",tagContent:""})}}function y(t){var e,n;const o=this;null!==(e=(n=r()(o)).atwho)&&void 0!==e&&e.call(n,"isSelecting")||(T(t,o),t.isDefaultPrevented()||function(t,e){if(!gon.markdown_maintain_indentation)return;if(!E(t,e))return;const n=v(e),o=n.lines[0].match(d);if(!o)return;const{indent:r,content:s}=o.groups;n.selectionStart-n.startPos<r.length||(s?(t.preventDefault(),O({tag:r,textArea:e,blockTag:"",wrap:!1,select:"",tagContent:""})):e.selectionStart-=o[0].length)}(t,o),function(t,e){if(!gon.markdown_surround_selection)return;if(t.metaKey||t.ctrlKey)return;if(e.selectionStart===e.selectionEnd)return;const n={"*":"**{text}**",_:"_{text}_","`":"`{text}`","'":"'{text}'",'"':'"{text}"',"[":"[{text}]","{":"{{text}}","(":"({text})","<":"<{text}>"}[t.key];n&&(t.preventDefault(),O({tag:n,textArea:e,blockTag:"",wrap:!0,select:"",tagContent:""}))}(t,o))}function P(){g=!0}function A(){g=!1}function M(t){!function(t){const e=t.target;if(e.selectionStart===e.selectionEnd)return;const n=e.value;if(b(n,e))return;if(!t.clipboardData)return;let o=t.clipboardData.getData("text");if(o&&(o=o.trim(),Object(a.x)(o))){t.preventDefault(),t.stopImmediatePropagation();const r=`[${p(n,e)}](${o})`;Object(c.q)(e,r)}}(null!=t&&t.originalEvent?t.originalEvent:t)}function D(t){const e=t.closest(".md-area").find("textarea");if(e.length)switch(t.data("mdCommand")){case"indentLines":!function(t){const e=t.get(0),{lines:n,selectionStart:o,selectionEnd:r,startPos:s,endPos:i}=v(e),a=[];let l=0;e.focus(),e.setSelectionRange(s,i),n.forEach((function(t){t=" ".repeat(2)+t,l+=2,a.push(t)}));const u=a.join("\n");Object(c.q)(e,u),S(e,o,r,s,2,l)}(e);break;case"outdentLines":!function(t){const e=t.get(0),{lines:n,selectionStart:o,selectionEnd:r,startPos:s,endPos:i}=v(e),a=[];let l=0,u=-1,d=0;e.focus(),e.setSelectionRange(s,i),n.forEach((function(t){if(d=0,t.length>0){for(;d<2&&" "===t[d];)d+=1;d>0&&(t=t.slice(d),l+=d)}-1===u&&(u=d),a.push(t)}));const f=a.join("\n");l>0&&Object(c.q)(e,f),S(e,o,r,s,-u,-l)}(e);break;default:return O({textArea:e,tag:t.data("mdTag"),cursorOffset:t.data("mdCursorOffset"),blockTag:t.data("mdBlock"),wrap:!t.data("mdPrepend"),select:t.data("mdSelect"),tagContent:t.attr("data-md-tag-content")})}}function _(t){r()(".markdown-area",t).on("keydown",y).on("compositionstart",P).on("compositionend",A).on("paste",M).each((function(){s.default.initMarkdownEditorShortcuts(r()(this),D)}));return r()(t).off("click",".js-md").on("click",".js-md",(function(){return D(r()(this))}))}function R(t){r()(".js-md").off("click").on("click",(function(e){const{mdTag:n,mdBlock:o,mdPrepend:s,mdSelect:c}=r()(e.currentTarget).data();w({tag:n,blockTag:o,wrap:!s,select:c,selected:t.getSelectedText(),text:t.getValue(),editor:t}),t.focus()}))}function C(t){return r()(".markdown-area",t).off("keydown",y).off("compositionstart",P).off("compositionend",A).off("paste",M).each((function(){s.default.removeMarkdownEditorShortcuts(r()(this))})),r()(".js-md",t).off("click")}const $=async function(t,e=""){const{lines:n,startPos:o}=v(t);if(n>0)return null;const r=n[0];if(!/!\[.+?\]\(.+?\)/.test(r))return null;const s=t.selectionStart-o,c=r.substring(0,s).lastIndexOf("!"),a=r.substring(s).indexOf(")");if(c>=0&&a>=0){const t=r.substring(c,s+a+1),{data:n}=await i.a.post(e,{text:t}),o=(new DOMParser).parseFromString(n.body,"text/html").body.querySelector("a").getAttribute("href");if(o){const e=o.substring(o.lastIndexOf("/")+1);return{imageMarkdown:t,imageURL:o,filename:e}}}return null},I=function(t){var e;const n=Math.max(2,(null===(e=t.match(/```+/g))||void 0===e||null===(e=e.sort((function(t,e){return e.length-t.length}))[0])||void 0===e?void 0:e.length)||0)+1;return"`".repeat(n)}},"v+Mp":function(t,e,n){"use strict";n.r(e),n.d(e,"LOCAL_MOUSETRAP_DATA_KEY",(function(){return b})),n.d(e,"default",(function(){return S}));var o=n("8Doe"),r=n.n(o),s=(n("B++/"),n("z6RN"),n("47t/"),n("Tznw"),n("IYH6"),n("6yen"),n("OeRx"),n("l/dT"),n("RqS2"),n("Zy7a"),n("cjZU"),n("OAhk"),n("X42P"),n("mHhP"),n("fn0I"),n("UB/6"),n("imhG"),n("dHQd"),n("yoDG"),n("KeS/"),n("tWNI"),n("8d6S"),n("VwWG"),n("IYHS"),n("rIA9"),n("MViX"),n("zglm"),n("GDOA"),n("hlbI"),n("a0mT"),n("u3H1"),n("ta8/"),n("IKCR"),n("nmTw"),n("W2kU"),n("58fc"),n("7dtT"),n("Rhav"),n("uhEP"),n("eppl"),n("ZzK0"),n("BzOf"),n("EmJ/")),c=n.n(s),i=n("ewH8"),a=n("ygVz"),l=n("C83f"),u=n("O6Bj"),d=n("NmEs"),f=n("1OWu"),h=n("yQ8t"),g=n("3twG"),p=n("d08M"),m=n("wQDE");const b="local-mousetrap-instance";function v(t){const e=t.closest(".md-area").find(".js-md"),n=new Map;return e.each((function(){const t=c()(this),e=t.data("md-shortcuts");null!=e&&e.length&&n.set(t,e)})),n}class S{constructor(){var t;this.extensions=new Map,this.onToggleHelp=this.onToggleHelp.bind(this),this.helpModalElement=null,this.helpModalVueInstance=null,this.addAll([[p.Ab,this.onToggleHelp],[p.wb,S.focusSearchFile],[p.vb,S.focusSearch],[p.e,this.focusFilter.bind(this)],[p.Cb,S.onTogglePerfBar],[p.G,S.hideAppearingContent],[p.yb,S.onToggleCanary],[p.g,function(){return Object(h.a)(".brand-logo")}],[p.F,function(){return Object(h.a)(".shortcuts-todos")}],[p.f,function(){return Object(h.a)(".dashboard-shortcuts-activity")}],[p.A,function(){return Object(h.a)(".dashboard-shortcuts-issues")}],[p.B,function(){return Object(h.a)(".dashboard-shortcuts-merge_requests, .js-merge-request-dashboard-shortcut")}],[p.D,function(){return Object(h.a)(".dashboard-shortcuts-review_requests, .js-merge-request-dashboard-shortcut")}],[p.C,function(){return Object(h.a)(".dashboard-shortcuts-projects")}],[p.z,function(){return Object(h.a)(".dashboard-shortcuts-groups")}],[p.h,function(){return Object(h.a)(".dashboard-shortcuts-milestones")}],[p.E,function(){return Object(h.a)(".dashboard-shortcuts-snippets")}],[p.Bb,S.toggleMarkdownPreview],[p.b,S.focusDuoChat]]),Object(u.c)((function(t,e,n){return!Object(p.Gb)(p.Bb).includes(n)&&void 0})),null!==(t=gon)&&void 0!==t&&null!==(t=t.features)&&void 0!==t&&t.findAndReplace&&(this.add(p.c,S.toggleFindAndReplaceBar),Object(u.c)((function(t,e,n){return!Object(p.Gb)(p.c).includes(n)&&void 0}))),c()(document).on("click",".js-shortcuts-modal-trigger",this.onToggleHelp),Object(m.b)()&&Object(m.a)(),this.filterSelectors=["input[type=search]:not(#diff-tree-search)",".gl-filtered-search-term-input",".filtered-search"]}addExtension(t,e=[],n=new Set){n.add(t);let o=this.extensions.get(t);if(!o){for(const e of null!==(r=t.dependencies)&&void 0!==r?r:[]){var r;n.has(e)||e===S||(n.add(e),this.addExtension(e,[],n))}o=new t(this,...e),this.extensions.set(t,o)}return n.delete(t),o}add(t,e){u.b.bind(Object(p.Gb)(t),e)}addAll(t){var e=this;t.forEach((function(t){return e.add(...t)}))}onToggleHelp(t){var e=this;null!=t&&t.preventDefault&&t.preventDefault(),this.helpModalElement&&this.helpModalVueInstance?(this.helpModalVueInstance.$destroy(),this.helpModalElement.remove(),this.helpModalElement=null,this.helpModalVueInstance=null):(this.helpModalElement=document.createElement("div"),document.body.append(this.helpModalElement),this.helpModalVueInstance=new i.default({el:this.helpModalElement,name:"ShortcutsHelpRoot",components:{ShortcutsHelp:function(){return Promise.all([n.e("77a00e0c"),n.e("e440161e"),n.e("85a2dfb8"),n.e("628f1e7f"),n.e("448174c8")]).then(n.bind(null,"exIq"))}},render:function(t){return t("shortcuts-help",{on:{hidden:e.onToggleHelp}})}}))}static onTogglePerfBar(t){t.preventDefault();Object(d.G)(Object(d.j)("perf_bar_enabled"))?Object(d.N)("perf_bar_enabled","false",{path:"/"}):Object(d.N)("perf_bar_enabled","true",{path:"/"}),Object(g.E)()}static onToggleCanary(t){t.preventDefault();const e=Object(d.G)(Object(d.j)("gitlab_canary"));Object(d.N)("gitlab_canary",(!e).toString(),{expires:365,path:"/"}),Object(g.E)()}static toggleMarkdownPreview(t){c()(document).triggerHandler("markdown-preview:toggle",[t])}static toggleFindAndReplaceBar(t){c()(document).triggerHandler("markdown-editor:find-and-replace",[t])}focusFilter(t){const e=document.querySelectorAll(this.filterSelectors.join(",")),n=Array.from(e).find((function(t){return t.offsetParent}));null==n||n.focus(),t.preventDefault()}static focusSearch(t){var e;null===(e=document.querySelector("#super-sidebar-search"))||void 0===e||e.click(),a.a.trackEvent("press_keyboard_shortcut_to_activate_command_palette"),t.preventDefault&&t.preventDefault()}static async focusSearchFile(t){var e,n;if(!/^projects:/.test(document.body.dataset.page))return;null!=t&&t.key&&a.a.trackEvent(l.f),null==t||t.preventDefault(),null===(e=document.querySelector("#super-sidebar-search"))||void 0===e||e.click();const o=await Object(f.n)("#super-sidebar-search-modal #search");if(!o)return;const r=null===(n=document.querySelector(".js-repo-breadcrumbs"))||void 0===n?void 0:n.dataset.currentPath;o.value="~"+(r?r+"/":""),o.dispatchEvent(new Event("input"))}static hideAppearingContent(t){document.querySelectorAll(".tooltip, .popover").forEach((function(t){t.style.display="none"})),t.preventDefault&&t.preventDefault()}static focusDuoChat(t){var e;null===(e=document.querySelector(".js-tanuki-bot-chat-toggle"))||void 0===e||e.click(),t.preventDefault&&t.preventDefault()}static initMarkdownEditorShortcuts(t,e){const n=v(t),o=new u.b(t[0]);t.data(b,o),n.forEach((function(t,n){o.bind(t,(function(t){t.preventDefault(),e(n)}))}));const s=r()([...n.values()]),c=u.b.prototype.stopCallback;o.stopCallback=function(t,e,n){return!s.includes(n)&&c.call(this,t,e,n)}}static removeMarkdownEditorShortcuts(t){const e=t.data(b);e&&v(t).forEach((function(t){e.unbind(t)}))}}}}]);
//# sourceMappingURL=540c13ba.5a50b735.chunk.js.map